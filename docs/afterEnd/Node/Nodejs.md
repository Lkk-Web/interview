---
group:
  # title: 'åç«¯'
  order: 3
order: 1
---

# Nodejs

å®˜æ–¹æ–‡æ¡£ï¼š[Node](https://nodejs.org/en/docs/)

## ç®€ä»‹

æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ

GraphQL

esql

RPC

é«˜å¹¶å‘

redis

cnpm ã€ npm ã€pnpm çš„åŒºåˆ«

## 1ã€åŸºæœ¬æ¦‚å¿µ Node æ˜¯ä»€ä¹ˆï¼Ÿ

## CommonJS è§„èŒƒ

> ç° ES6 çš„ Module åŸºæœ¬å–ä»£äº† Commandjs è§„èŒƒå’Œ AMD è§„èŒƒ

Node åº”ç”¨ç”±æ¨¡å—ç»„æˆï¼Œé‡‡ç”¨ CommonJS æ¨¡å—è§„èŒƒã€‚

CommonJS è§„èŒƒè§„å®šï¼Œæ¯ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œæœ‰è‡ªå·±çš„ä½œç”¨åŸŸã€‚æ¯ä¸ªæ¨¡å—å†…éƒ¨ï¼Œmodule å˜é‡ä»£è¡¨å½“å‰æ¨¡å—ã€‚è¿™ä¸ªå˜é‡æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒçš„ exports å±æ€§ï¼ˆå³ module.exportsï¼‰æ˜¯å¯¹å¤–çš„æ¥å£ã€‚åŠ è½½æŸä¸ªæ¨¡å—ï¼Œå…¶å®æ˜¯åŠ è½½è¯¥æ¨¡å—çš„ module.exports å±æ€§ã€‚

å¦‚æœæƒ³åœ¨å¤šä¸ªæ–‡ä»¶åˆ†äº«å˜é‡ï¼Œå¿…é¡»å®šä¹‰ä¸º global å¯¹è±¡çš„å±æ€§ã€‚

CommonJS æ¨¡å—çš„ç‰¹ç‚¹å¦‚ä¸‹ã€‚

- æ‰€æœ‰ä»£ç éƒ½è¿è¡Œåœ¨æ¨¡å—ä½œç”¨åŸŸï¼Œä¸ä¼šæ±¡æŸ“å…¨å±€ä½œç”¨åŸŸã€‚

- æ¨¡å—å¯ä»¥å¤šæ¬¡åŠ è½½ï¼Œä½†æ˜¯åªä¼šåœ¨ç¬¬ä¸€æ¬¡åŠ è½½æ—¶è¿è¡Œä¸€æ¬¡ï¼Œç„¶åè¿è¡Œç»“æœå°±è¢«ç¼“å­˜äº†ï¼Œä»¥åå†åŠ è½½ï¼Œå°±ç›´æ¥è¯»å–ç¼“å­˜ç»“æœã€‚è¦æƒ³è®©æ¨¡å—å†æ¬¡è¿è¡Œï¼Œå¿…é¡»æ¸…é™¤ç¼“å­˜ã€‚

- æ¨¡å—åŠ è½½çš„é¡ºåºï¼ŒæŒ‰ç…§å…¶åœ¨ä»£ç ä¸­å‡ºç°çš„é¡ºåºã€‚

- CommonJS è§„èŒƒåŠ è½½æ¨¡å—æ˜¯åŒæ­¥çš„,AMD è§„èŒƒæ˜¯å¼‚æ­¥çš„ï¼Œç”±äº Node.js ä¸»è¦ç”¨äºæœåŠ¡å™¨ç¼–ç¨‹ï¼Œæ¨¡å—æ–‡ä»¶ä¸€èˆ¬éƒ½å·²ç»å­˜åœ¨äºæœ¬åœ°ç¡¬ç›˜ï¼Œæ‰€ä»¥åŠ è½½èµ·æ¥æ¯”è¾ƒå¿«ï¼Œä¸ç”¨è€ƒè™‘éåŒæ­¥åŠ è½½çš„æ–¹å¼ï¼Œæ‰€ä»¥ CommonJS è§„èŒƒæ¯”è¾ƒé€‚ç”¨ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ˜¯æµè§ˆå™¨ç¯å¢ƒï¼Œè¦ä»æœåŠ¡å™¨ç«¯åŠ è½½æ¨¡å—ï¼Œè¿™æ—¶å°±å¿…é¡»é‡‡ç”¨éåŒæ­¥æ¨¡å¼ï¼Œå› æ­¤æµè§ˆå™¨ç«¯ä¸€èˆ¬é‡‡ç”¨ AMD è§„èŒƒã€‚

### 1.1ã€exports è§„èŒƒ

module.exports å±æ€§è¡¨ç¤ºå½“å‰æ¨¡å—å¯¹å¤–è¾“å‡ºçš„æ¥å£ï¼Œå…¶ä»–æ–‡ä»¶åŠ è½½è¯¥æ¨¡å—ï¼Œå®é™…ä¸Šå°±æ˜¯è¯»å– module.exports å˜é‡ã€‚

```javascript
module.exports = 'Hello world';
```

`exports`å’Œ`module.export` éƒ½æ˜¯æ„å‘³ç€æ˜¯ä¸ªæ¨¡å—çš„å¯¹å¤–æ¥å£ï¼Œå› æ­¤å°½é‡é¿å…é‡æ–°èµ‹å€¼

### 1.2ã€require è§„èŒƒ

require å‘½ä»¤ç”¨äºåŠ è½½æ–‡ä»¶ï¼Œåç¼€åé»˜è®¤ä¸º.js

```javascript
// requireæ–¹æ³•ç”¨äºåŠ è½½æ¨¡å—ã€‚
var example = require('./example.js');
```

> å¦‚æœå‚æ•°å­—ç¬¦ä¸²ä¸ä»¥â€œ./â€œæˆ–â€/â€œå¼€å¤´ï¼Œåˆ™è¡¨ç¤ºåŠ è½½çš„æ˜¯ä¸€ä¸ªé»˜è®¤æä¾›çš„æ ¸å¿ƒæ¨¡å—ï¼ˆä½äº Node çš„ç³»ç»Ÿå®‰è£…ç›®å½•ä¸­ï¼‰ï¼Œæˆ–è€…ä¸€ä¸ªä½äºå„çº§ node_modules ç›®å½•çš„å·²å®‰è£…æ¨¡å—ï¼ˆå…¨å±€å®‰è£…æˆ–å±€éƒ¨å®‰è£…ï¼‰ã€‚

- å¦‚æœæƒ³å¾—åˆ° require å‘½ä»¤åŠ è½½çš„ç¡®åˆ‡æ–‡ä»¶åï¼Œä½¿ç”¨ `require.resolve()`æ–¹æ³•ã€‚

#### 1.2.1ã€require.main

require æ–¹æ³•æœ‰ä¸€ä¸ª main å±æ€§ï¼Œå¯ä»¥ç”¨æ¥åˆ¤æ–­æ¨¡å—æ˜¯ç›´æ¥æ‰§è¡Œï¼Œè¿˜æ˜¯è¢«è°ƒç”¨æ‰§è¡Œã€‚

ç›´æ¥æ‰§è¡Œçš„æ—¶å€™ï¼ˆnode module.jsï¼‰ï¼Œrequire.main å±æ€§æŒ‡å‘æ¨¡å—æœ¬èº«ã€‚

```javascript
require.main === module;
```

è°ƒç”¨æ‰§è¡Œçš„æ—¶å€™ï¼ˆé€šè¿‡ require åŠ è½½è¯¥è„šæœ¬æ‰§è¡Œï¼‰ï¼Œä¸Šé¢çš„è¡¨è¾¾å¼è¿”å› false

### 1.3ã€æ¨¡å—åŠ è½½æœºåˆ¶

CommonJS æ¨¡å—çš„åŠ è½½æœºåˆ¶æ˜¯ï¼Œè¾“å‡ºçš„å€¼æ˜¯è¢«è¾“å‡ºçš„å€¼çš„æ‹·è´ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦è¾“å‡ºä¸€ä¸ªå€¼ï¼Œæ¨¡å—å†…éƒ¨çš„å˜åŒ–å°±å½±å“ä¸åˆ°è¿™ä¸ªå€¼ã€‚ã€‚

### 1.4ã€æ¨¡å—ç¼“å­˜æœºåˆ¶

ç¬¬ä¸€æ¬¡åŠ è½½æŸä¸ªæ¨¡å—æ—¶ï¼ŒNode ä¼šç¼“å­˜è¯¥æ¨¡å—ã€‚ä»¥åå†åŠ è½½è¯¥æ¨¡å—ï¼Œå°±ç›´æ¥ä»ç¼“å­˜å–å‡ºè¯¥æ¨¡å—çš„ module.exports å±æ€§ã€‚

```javascript
require('./example.js');
require('./example.js').message = 'hello';
require('./example.js').message;
// "hello"
```

ä¸Šé¢ä»£ç ä¸­ï¼Œè¿ç»­ä¸‰æ¬¡ä½¿ç”¨ require å‘½ä»¤ï¼ŒåŠ è½½åŒä¸€ä¸ªæ¨¡å—ã€‚ç¬¬äºŒæ¬¡åŠ è½½çš„æ—¶å€™ï¼Œä¸ºè¾“å‡ºçš„å¯¹è±¡æ·»åŠ äº†ä¸€ä¸ª message å±æ€§ã€‚ä½†æ˜¯ç¬¬ä¸‰æ¬¡åŠ è½½çš„æ—¶å€™ï¼Œè¿™ä¸ª message å±æ€§ä¾ç„¶å­˜åœ¨ï¼Œè¿™å°±è¯æ˜ require å‘½ä»¤å¹¶æ²¡æœ‰é‡æ–°åŠ è½½æ¨¡å—æ–‡ä»¶ï¼Œè€Œæ˜¯è¾“å‡ºäº†ç¼“å­˜ã€‚

å¦‚æœæƒ³è¦å¤šæ¬¡æ‰§è¡ŒæŸä¸ªæ¨¡å—ï¼Œå¯ä»¥è®©è¯¥æ¨¡å—è¾“å‡ºä¸€ä¸ªå‡½æ•°ï¼Œç„¶åæ¯æ¬¡ require è¿™ä¸ªæ¨¡å—çš„æ—¶å€™ï¼Œé‡æ–°æ‰§è¡Œä¸€ä¸‹è¾“å‡ºçš„å‡½æ•°ã€‚

æ‰€æœ‰ç¼“å­˜çš„æ¨¡å—ä¿å­˜åœ¨ require.cache ä¹‹ä¸­ï¼Œå¦‚æœæƒ³åˆ é™¤æ¨¡å—çš„ç¼“å­˜ï¼Œå¯ä»¥åƒä¸‹é¢è¿™æ ·å†™ã€‚

```javascript
// åˆ é™¤æŒ‡å®šæ¨¡å—çš„ç¼“å­˜
delete require.cache[moduleName];

// åˆ é™¤æ‰€æœ‰æ¨¡å—çš„ç¼“å­˜
Object.keys(require.cache).forEach(function (key) {
  delete require.cache[key];
});
```

æ³¨æ„ï¼Œç¼“å­˜æ˜¯æ ¹æ®ç»å¯¹è·¯å¾„è¯†åˆ«æ¨¡å—çš„ï¼Œå¦‚æœåŒæ ·çš„æ¨¡å—åï¼Œä½†æ˜¯ä¿å­˜åœ¨ä¸åŒçš„è·¯å¾„ï¼Œrequire å‘½ä»¤è¿˜æ˜¯ä¼šé‡æ–°åŠ è½½è¯¥æ¨¡å—ã€‚

### 1.5 CMD è§„èŒƒ

CMDï¼ˆCommon Module Definitionï¼‰æ˜¯å›½å†…å¤§ç‰›ç‰ä¼¯åœ¨å¼€å‘ SeaJS çš„æ—¶å€™æå‡ºæ¥çš„ï¼Œ`å±äº CommonJS çš„ä¸€ç§è§„èŒƒ`ï¼Œæ ¹æ®æµè§ˆå™¨çš„å¼‚æ­¥ç¯å¢ƒåšäº†è‡ªå·±çš„å®ç°ã€‚å®ƒå’Œ AMD å¾ˆç›¸ä¼¼ï¼Œå°½é‡ä¿æŒç®€å•ï¼Œå¹¶ä¸ CommonJS å’Œ Node.js çš„ Modules è§„èŒƒä¿æŒäº†å¾ˆå¤§çš„å…¼å®¹æ€§ã€‚

### 1.5.1 define æ–¹æ³•ï¼šå®šä¹‰æ¨¡å—

åœ¨ CMD ä¸­ï¼Œä¸€ä¸ªæ¨¡å—å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œæ ¼å¼ä¸ºï¼šdefine( factory )ï¼›define æ˜¯ä¸€ä¸ªå…¨å±€å‡½æ•°ï¼Œç”¨æ¥å®šä¹‰æ¨¡å—ã€‚

defin.cmd å±æ€§æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œå¯ç”¨æ¥åˆ¤å®šå½“å‰é¡µé¢æ˜¯å¦æœ‰ CMD æ¨¡å—åŠ è½½å™¨ï¼Œå…¶ç”¨æ³•è·Ÿ AMD çš„ denfine.amd ç›¸ä¼¼ï¼Œå†™æ³•å¦‚ä¸‹ï¼š

```js
if (typeof define === 'function' && define.cmd) {
  // æœ‰ Sea.js ç­‰ CMD æ¨¡å—åŠ è½½å™¨å­˜åœ¨
}
```

## 2ã€æ´‹è‘±åœˆæ¨¡å‹

åœ¨ `koa` ä¸­ï¼Œä¸­é—´ä»¶è¢« `next()` æ–¹æ³•åˆ†æˆäº†ä¸¤éƒ¨åˆ†ã€‚`next()` æ–¹æ³•ä¸Šé¢éƒ¨åˆ†ä¼šå…ˆæ‰§è¡Œï¼Œä¸‹é¢éƒ¨é—¨ä¼šåœ¨åç»­ä¸­é—´ä»¶æ‰§è¡Œå…¨éƒ¨ç»“æŸä¹‹åå†æ‰§è¡Œã€‚

æˆ‘ä»¬éœ€è¦çŸ¥é“ä¸€ä¸ªè¯·æ±‚æˆ–è€…æ“ä½œ `db` çš„è€—æ—¶æ˜¯å¤šå°‘ï¼Œè€Œä¸”æƒ³è·å–å…¶ä»–ä¸­é—´ä»¶çš„ä¿¡æ¯ã€‚åœ¨ `koa` ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `async await` çš„æ–¹å¼ç»“åˆæ´‹è‘±æ¨¡å‹åšåˆ°ã€‚

```javascript
app.use(async (ctx, next) => {
  const start = new Date();
  await next();
  const delta = new Date() - start;
  console.log(`è¯·æ±‚è€—æ—¶: ${delta} MS`);
  console.log('æ‹¿åˆ°ä¸Šä¸€æ¬¡è¯·æ±‚çš„ç»“æœï¼š', ctx.state.baiduHTML);
});

app.use(async (ctx, next) => {
  // å¤„ç† db æˆ–è€…è¿›è¡Œ HTTP è¯·æ±‚
  ctx.state.baiduHTML = await axios.get('http://baidu.com');
});
```

## 3ã€Node EventLoop

NodeJS ä¸­çš„ EventLoop ä½¿ NodeJS èƒ½å¤Ÿè¿›è¡Œéé˜»å¡çš„ I/O æ“ä½œï¼Œå°½ç®¡ JavaScript æ˜¯å•çº¿ç¨‹çš„ï¼Œå¯ä»¥é€šè¿‡å°† I/O æ“ä½œäº¤ç»™ç³»ç»Ÿå†…æ ¸å»æ‰§è¡Œã€‚

å½“æŸä¸ª I/O æ“ä½œç»“æŸçš„æ—¶å€™ï¼Œå†…æ ¸ä¼šå°†å¯¹åº”çš„ callback å‡½æ•°å…ƒä¿¡æ¯äº¤ç»™ NodeJS ä¸­çš„ poll queue(è½®è¯¢é˜Ÿåˆ—)ã€‚

å½“æˆ‘ä»¬çš„è„šæœ¬ä¸­è°ƒç”¨äº†`å¼‚æ­¥å‡½æ•°`ï¼Œè®¡æ—¶å™¨æˆ–è€… process.nextTick()çš„æ—¶å€™ï¼ŒEventLoop æœºåˆ¶å°±ä¼šå¼€å§‹ä»‹å…¥ã€‚

ä¸‹å›¾ç®€æ˜åœ°å±•ç¤ºäº† EventLoop çš„æ“ä½œé¡ºåºï¼š

```
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€>â”‚           timers          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚     pending callbacks     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚       idle, prepare       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   incoming:   â”‚
â”‚  â”‚           poll            â”‚<â”€â”€â”€â”€â”€â”¤  connections, â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   data, etc.  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”‚           check           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”¤      close callbacks      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- `timersï¼ˆè®¡æ—¶é˜¶æ®µï¼‰`ï¼šè¿™ä¸ªé˜¶æ®µæ‰§è¡Œç”± setTimeout() å’Œ setInterval() è°ƒåº¦çš„å›è°ƒã€‚

  Â· NodeJS.Timeout æ˜¯ Node.js å®šä¹‰çš„ç±»å‹ï¼Œè¡¨ç¤ºå®šæ—¶å™¨å¯¹è±¡ã€‚

  ```ts
      // å¯åŠ¨ä¸€ä¸ª 30 ç§’çš„å®šæ—¶å™¨, è¸¢å‡ºæœªå‡†å¤‡çš„ç©å®¶
      const removeTimer = setTimeout(() => { this.leave(undefined, deskInfo) }, 30000)
      DeskClubService.timers.set(deskID, removeTimer)
      // å®šæ—¶å™¨è¿”å›å€¼ä¸ºidï¼Œnodeç¯å¢ƒä¸º NodeJS.Timeout ç±»å‹
      const removeTimer = DeskClubService.timers.get(deskID)
      removeTimer && clearTimeout(removeTimer)
      static timers: Map<string, NodeJS.Timeout> = new Map();  // æ‰€æœ‰æˆ¿é—´
  ```

- `pending callbacksï¼ˆå›è°ƒå¾…å¤„ç†é˜¶æ®µï¼‰`ï¼šè¿™ä¸ªé˜¶æ®µæ‰§è¡Œå»¶è¿Ÿåˆ°ä¸‹ä¸€æ¬¡å¾ªç¯è¿­ä»£çš„ I/O å›è°ƒã€‚
- `idle, prepareï¼ˆé—²ç½®é˜¶æ®µï¼‰`ï¼šä»…ä»…è¢« NodeJS å†…éƒ¨ä½¿ç”¨ã€‚ï¼ˆè¿™é‡Œæ˜¯æ ¹æ®å®˜æ–¹æ–‡æ¡£æè¿°çš„ï¼Œä¸èƒ½ç”šè§£ï¼‰
- `pollï¼ˆè½®è¯¢é˜¶æ®µï¼‰`ï¼šè¿™ä¸ªé˜¶æ®µæ£€ç´¢ I/O äº‹ä»¶ï¼Œæ‰§è¡Œ I/O äº‹ä»¶å¯¹åº”çš„å›è°ƒå‡½æ•°ï¼ˆé™¤äº†å…³é—­å›è°ƒã€è®¡æ—¶å™¨è°ƒåº¦çš„å›è°ƒå’Œ setImmediate() ä¹‹å¤–çš„å‡ ä¹æ‰€æœ‰å¼‚æ­¥æ“ä½œï¼‰ï¼Œéƒ½å°†ä¼šåœ¨è¿™ä¸ªé˜¶æ®µè¢«å¤„ç†ã€‚
- `checkï¼ˆæ£€æµ‹é˜¶æ®µï¼‰`ï¼šsetImmediate()å‡½æ•°çš„å›è°ƒå‡½æ•°å°†ä¼šåœ¨è¿™é‡Œè¢«å¤„ç†ã€‚
- `close callbacksï¼ˆå…³é—­å›è°ƒé˜¶æ®µï¼‰`ï¼šä¾‹å¦‚ï¼šsocket.on('close', ...)

## 4ã€pm2 éƒ¨ç½²

### 4.1 å®‰è£…å¿…è¦ç¯å¢ƒ

1. å®‰è£…æº

```bash
sudo apt update && sudo apt upgrade -y
```

2. å®‰è£…æ„å»ºå·¥å…·ï¼ˆnpmã€pm2ã€cross-envï¼‰

```bash
sudo apt install -y nodejs npm
sudo npm install -g pm2 cross-env
```

3. æ£€æŸ¥å®‰è£…ç»“æœ

```bash
node -v
npm -v
pm2 -v
```

### 4.2 äº§ç‰©æ„å»º

1. æ‹‰å–é¡¹ç›®ä»£ç 

`git clone <ä½ çš„ä»“åº“åœ°å€>`ã€`cd <é¡¹ç›®ç›®å½•>`

2. å®‰è£…ä¾èµ–å¹¶æ„å»ºäº§ç‰©

```bash
npm install
npm run build   # æˆ– yarn buildï¼Œçœ‹ä½ çš„é¡¹ç›®å®šä¹‰
```

### 4.3 PM2 å¯åŠ¨æœåŠ¡

å¯åŠ¨ pm2: `pm2 start dist/main.js --name server_name`

âœ… å¯å†™å…¥ package.json è„šæœ¬

```jsonc
"scripts": {
  "prod": "cross-env RUN_ENV=prod.env pm2 start dist/main.js --name server_name"
}
```

ğŸ” æŸ¥çœ‹çŠ¶æ€ & ç®¡ç†æœåŠ¡

```bash
pm2 list                        # æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹
pm2 logs server_name        # æŸ¥çœ‹æ—¥å¿—
pm2 restart server_name     # é‡å¯
pm2 stop server_name        # åœæ­¢
pm2 delete server_name      # åˆ é™¤è¿›ç¨‹
```

å¼€æœºè‡ªå¯

```bash
pm2 startup              # è¾“å‡ºä¸€æ¡å‘½ä»¤ï¼Œå¤åˆ¶ç²˜è´´æ‰§è¡Œ
sudo env PATH=$PATH:/home/ubuntu/.nvm/versions/node/v18.17.0/bin pm2 startup systemd -u ubuntu --hp /home/ubuntu
pm2 save                 # ä¿å­˜å½“å‰è¿›ç¨‹çŠ¶æ€
```

ğŸ§ª ç»“æŸåæ£€æŸ¥

```sh
curl http://localhost:ç«¯å£
```
